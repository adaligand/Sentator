<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamic Flashcards Game</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
body { display: flex; flex-direction: column; justify-content: center; align-items: center; font-family: Arial, sans-serif; min-height: 100vh; background-color: #f5f5f5; }
.flashcard-container { perspective: 1000px; margin-bottom: 20px; }
.flashcard { width: 500px; height: 300px; background-color: white; border-radius: 10px; display: flex; justify-content: center; align-items: center; font-size: 50px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); text-align: center; transform-style: preserve-3d; transition: transform 0.6s; position: relative; }
.flipped { transform: rotateY(180deg); }
.flashcard .front, .flashcard .back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; justify-content: center; align-items: center; border-radius: 10px; }
.flashcard .back { background-color: #c5dde96e; transform: rotateY(180deg); }
.button-container { display: flex; gap: 10px; margin-top: 10px; }
button { padding: 10px 15px; border-radius: 10px; font-size: 20px; cursor: pointer; border: 2px solid #ccc; background-color: #f9f9f9; }
button:hover { background-color: #A9A9A9; color: #fff; }
.quiz-container, .text-input-container, .reset-container { display: none; margin-top: 20px; text-align: center; }
.quiz-options { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
.quiz-options button { font-size: 18px; padding: 10px; }
input { font-size: 20px; padding: 10px; border-radius: 10px; margin-top: 10px; }
input.error { border-color: red; background-color: #f8d7da; }
input.correct { border-color: green; background-color: #d4edda; }
.congratulations { font-size: 24px; font-weight: bold; color: green; margin-top: 20px; }
.keyboard-container { display: flex; flex-wrap: wrap; gap: 2px; justify-content: center; margin-top: 20px; }
.keyboard-button { font-size: 18px; padding: 10px; border-radius: 10px; cursor: pointer; width: 40px; height: 40px; }
select { margin-top: 10px; border-radius: 10px; padding: 5px; font-size: 16px; }
.hidden { display:none; }
</style>
</head>
<body>

<div class="flashcard-container">
  <div class="flashcard" onclick="flipCard()">
    <div class="front" id="frontText">Loading...</div>
    <div class="back" id="backText">Loading...</div>
  </div>
</div>

<div class="button-container">
  <button onclick="previousStep()" id="previousButton" class="hidden">Previous</button>
  <button onclick="nextStep()">Next</button>
</div>

<div class="quiz-container" id="quizContainer"></div>
<div class="text-input-container" id="textInputContainer"></div>

<select id="languageSelect" class="hidden" onchange="updateKeyboard()">
  <option value="french" selected>French</option>
  <option value="german">German</option>
  <option value="spanish">Spanish</option>
</select>

<div class="keyboard-container" id="keyboard"></div>
<div class="reset-container">
  <button onclick="resetExercise()">Restart Exercise</button>
</div>
<div class="congratulations hidden" id="congratulationsMessage"></div>

<script>
let currentIndex = 0;
let englishWords = [], translations = [];

// Get spreadsheet URL from query parameter
const params = new URLSearchParams(window.location.search);
const sheetUrl = params.get('sheet');

if(!sheetUrl) { 
    alert('No spreadsheet URL provided.'); 
}

// Load CSV using PapaParse
Papa.parse(sheetUrl, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
        if(!results.data || results.data.length === 0){
            alert("Failed to load CSV. Make sure the sheet is published as CSV and accessible.");
            return;
        }
        results.data.forEach(row => {
            if(row.English && row.French){
                englishWords.push(row.English.trim());
                translations.push(row.French.trim());
            }
        });
        if(englishWords.length === 0){
            alert("No valid vocabulary found in the CSV. Make sure your columns are named 'English' and 'French'.");
            return;
        }
        // Show first card
        currentIndex = 0;
        updateCard();
    },
    error: function(err){
        console.error("Error loading CSV:", err);
        alert("Error loading CSV. Check console for details.");
    }
});

function updateCard() {
    if(currentIndex < englishWords.length){
        document.getElementById('frontText').textContent = translations[currentIndex];
        document.getElementById('backText').textContent = englishWords[currentIndex];
        document.querySelector('.flashcard').classList.remove('flipped');
    } else showCongratulations();
}

function flipCard(){
    document.querySelector('.flashcard').classList.toggle('flipped');
}

function nextStep(){
    if(currentIndex < englishWords.length - 1){
        currentIndex++;
        updateCard();
        document.getElementById('previousButton').classList.remove('hidden');
    } else {
        showCongratulations();
    }
}

function previousStep(){
    if(currentIndex > 0){
        currentIndex--;
        updateCard();
    }
}

function showCongratulations(){
    document.querySelector('.flashcard-container').style.display='none';
    document.querySelector('.quiz-container').style.display='none';
    document.querySelector('.text-input-container').style.display='none';
    document.querySelector('.button-container').style.display='none';
    document.getElementById('keyboard').style.display='none';
    document.getElementById('languageSelect').classList.add('hidden');
    let msg=document.getElementById('congratulationsMessage');
    msg.classList.remove('hidden');
    msg.textContent="Congratulations! You've completed all the exercises!";
    document.querySelector('.reset-container').style.display='block';
}

function resetExercise(){
    currentIndex=0;
    document.querySelector('.flashcard-container').style.display='block';
    document.getElementById('congratulationsMessage').classList.add('hidden');
    document.querySelector('.reset-container').style.display='none';
    updateCard();
}

// Optional virtual keyboard
function updateKeyboard(){
    const keyboardContainer=document.getElementById('keyboard');
    keyboardContainer.innerHTML='';
    const language=document.getElementById('languageSelect').value;
    let chars=[];
    switch(language){
        case 'german': chars=['ä','ö','ü','ß']; break;
        case 'french': chars=['à','â','ä','é','è','ê','ë','î','ï','ô','ö','ù','ü','û','ç']; break;
        case 'spanish': chars=['á','é','í','ó','ú','ñ']; break;
    }
    chars.forEach(c=>{
        let btn=document.createElement('button');
        btn.textContent=c;
        btn.classList.add('keyboard-button');
        btn.onclick=()=>{ 
            const input=document.querySelector('.text-input-container input'); 
            if(input) input.value+=c; 
            input.focus(); 
        };
        keyboardContainer.appendChild(btn);
    });
}

document.getElementById('languageSelect').addEventListener('change', updateKeyboard);
updateKeyboard();
</script>

</body>
</html>
