<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>No vowels</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f5f5f5; /* Light grey background */
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
    }
    .container {
        width: 100%;
        max-width: 800px; /* Set a max-width for larger screens */
        padding: 40px;
        box-sizing: border-box;
        font-size: 16px;
        background-color: white; /* White background for the game area */
        border-radius: 15px; /* Rounded corners */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Subtle shadow */
    }
    .title { font-size: 40px; font-weight: bold; text-align: center; margin-bottom: 20px; }
    .subtitle { font-size: 20px; margin-bottom: 10px; text-align: center; }
    .counter { font-size: 20px; text-align: center; margin-bottom: 10px; }
    .english-word { display:block; margin: 0 auto 20px; font-size: 24px; padding: 10px 20px; border-radius: 10px; background-color: #eee; text-align: center; }
    .french-word {
        font-size: 30px;
        text-align: center;
        margin-bottom: 20px;
        word-spacing: 20px; /* increase space between words */
    }

    .missing-word { width: 15px; font-size: 20px; border: none; border-bottom: 1px solid #000; background: transparent; text-align: center; margin-right: 2px; }
    .correct { background-color: #cef4ce; }
    .incorrect { background-color: #ffb6c19c; }
    .keyboard-container { text-align: center; margin-top: 20px; }
    .keyboard-button { font-size: 18px; padding: 10px 15px; margin: 2px; border: none; border-radius: 10px; background-color: #f0f0f0; color: #000; cursor: pointer; }
    .keyboard-button:hover { background-color: #A9A9A9; transform: translateY(-4px); }
    select { width: 20%; padding: 5px; border-radius: 10px; margin: 10px auto; height: 35px; display: block; }
    .feedback { font-weight: bold; font-size: 24px; display: flex; gap: 10px; justify-content: center; align-items: center; margin-top: 10px; }
    #nextButton { padding: 10px 20px; border-radius: 10px; border: 2px solid #ccc; background: #f9f9f9; cursor: pointer; display: none; font-size: 24px;}
</style>
</head>
<body>
<div class="container">
    <div class="title">No vowels</div>
    <div class="subtitle">Fill in the missing vowels</div>
    <div class="counter" id="wordCounter"></div>
    <div class="english-word" id="englishWord"></div>
    <div class="french-word" id="frenchWord"></div>
    <div id="keyboardContainer" class="keyboard-container"></div>
    <select id="languageSelect">
        <option value="french" selected>French</option>
        <option value="german">German</option>
        <option value="spanish">Spanish</option>
    </select>
    <div id="feedback" class="feedback" style="display:none;">
        <span>Correct âœ…</span>
        <button id="nextButton" onclick="nextText()">Next</button>
    </div>
</div>

<script>
let vocabList = [];
let exerciseWords = [];
let currentIndex = 0;
let lastFocusedInput = null;
const vowels = ['a','e','i','o','u','Ã ','Ã¢','Ã¤','Ã©','Ã¨','Ãª','Ã«','Ã®','Ã¯','Ã´','Ã¶','Ã¹','Ã¼','Ã»','Ã¡','Ã©','Ã­','Ã³','Ãº'];

const params = new URLSearchParams(window.location.search);
const sheetUrl = params.get('sheet'); // CSV URL like ?sheet=https://...

if(!sheetUrl){ alert("No sheet URL provided!"); }

Papa.parse(sheetUrl, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results){
        results.data.forEach(row => {
            if(row.French && row.English){
                vocabList.push({ french: row.French.trim(), english: row.English.trim() });
            }
        });
        if(vocabList.length === 0){ alert("No items found in columns A/B!"); return; }

        // Pick 10 random words
        exerciseWords = vocabList.sort(() => 0.5 - Math.random()).slice(0,10);
        currentIndex = 0;
        generateExercise();
        generateKeyboard('french');
    },
    error: function(err){ console.error(err); alert("CSV load error: " + err); }
});

function generateExercise(){
    if(currentIndex >= exerciseWords.length){
        document.getElementById('frenchWord').textContent = "ðŸŽ‰ Completed all words!";
        document.getElementById('englishWord').textContent = "";
        document.getElementById('feedback').style.display="none";
        document.getElementById('wordCounter').textContent = "";
        return;
    }

    const word = exerciseWords[currentIndex].french;
    document.getElementById('englishWord').textContent = exerciseWords[currentIndex].english;
    const wordDiv = document.getElementById('frenchWord');
    wordDiv.innerHTML = "";

    for(let i=0; i<word.length; i++){
        const char = word[i];
        if(vowels.includes(char.toLowerCase())){
            const input = document.createElement('input');
            input.type = 'text';
            input.maxLength = 1;
            input.className = 'missing-word';
            input.dataset.index = i;
            input.addEventListener('input', validateInput);
            input.addEventListener('focus', () => { lastFocusedInput = input; });
            input.addEventListener('keydown', handleBackspace);
            wordDiv.appendChild(input);
        } else {
            const span = document.createElement('span');
            span.textContent = char;
            wordDiv.appendChild(span);
        }
    }


    document.getElementById('feedback').style.display="none";
    document.getElementById('nextButton').style.display="none";
    document.getElementById('wordCounter').textContent = `Word ${currentIndex+1} / ${exerciseWords.length}`;
}

// Handle input validation and cursor movement
function validateInput(e){
    const input = e.target;
    const word = exerciseWords[currentIndex].french;
    const correctChar = word[input.dataset.index].toLowerCase();

    if(input.value.toLowerCase() === correctChar){
        input.classList.add('correct');
        input.classList.remove('incorrect');
    } else {
        input.classList.add('incorrect');
        input.classList.remove('correct');
    }

    // Move cursor to next input automatically
    if(input.value.length === 1){
        let nextInput = input.nextElementSibling;
        while(nextInput && !nextInput.classList.contains('missing-word')){
            nextInput = nextInput.nextElementSibling;
        }
        if(nextInput){ nextInput.focus(); }
    }

    // Check if all inputs correct
    const allInputs = document.querySelectorAll('.missing-word');
    let allCorrect = true;
    allInputs.forEach(inp => { if(!inp.classList.contains('correct')) allCorrect = false; });

    if(allCorrect){
        document.getElementById('feedback').style.display="flex";
        document.getElementById('nextButton').style.display="inline-block";
    }
}

// Handle backspace to move to previous input
function handleBackspace(e){
    if(e.key === "Backspace"){
        e.preventDefault(); // Prevent default backspace behavior
        const input = e.target;
        input.value = '';
        input.classList.remove('correct', 'incorrect');

        // Move to previous input
        let prevInput = input.previousElementSibling;
        while(prevInput && !prevInput.classList.contains('missing-word')){
            prevInput = prevInput.previousElementSibling;
        }
        if(prevInput){
            prevInput.focus();
            prevInput.value = '';
            prevInput.classList.remove('correct', 'incorrect');
        }
    }
}


function nextText(){
    currentIndex++;
    generateExercise();
}

function generateKeyboard(language){
    const container = document.getElementById('keyboardContainer');
    container.innerHTML = '';
    let chars = [];
    switch(language){
        case 'french': chars=['Ã ','Ã¢','Ã¤','Ã©','Ã¨','Ãª','Ã«','Ã®','Ã¯','Ã´','Ã¶','Ã¹','Ã¼','Ã»','Ã§']; break;
        case 'german': chars=['Ã¤','Ã¶','Ã¼','ÃŸ']; break;
        case 'spanish': chars=['Ã¡','Ã©','Ã­','Ã³','Ãº','Ã±']; break;
    }
    chars.forEach(c => {
        const btn = document.createElement('button');
        btn.textContent = c;
        btn.className = 'keyboard-button';
        btn.type = 'button';
        btn.onclick = () => {
            if(lastFocusedInput){
                const pos = lastFocusedInput.selectionStart;
                const val = lastFocusedInput.value;
                lastFocusedInput.value = val.slice(0,pos) + c + val.slice(pos);
                lastFocusedInput.setSelectionRange(pos+1,pos+1);
                lastFocusedInput.focus();
                lastFocusedInput.dispatchEvent(new Event('input'));
            }
        };
        container.appendChild(btn);
    });
}

document.getElementById('languageSelect').addEventListener('change', (e) => {
    generateKeyboard(e.target.value);
});
</script>
</body>
</html>
