<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>No vowels</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
body { font-family: Arial, sans-serif; }
.container { width: 100%; padding: 20px; box-sizing: border-box; font-size: 16px; }
.title { font-size: 40px; font-weight: bold; text-align: center; margin-bottom: 20px; }
.subtitle { font-size: 20px; margin-bottom: 10px; }
.counter { font-size: 24px; font-weight: bold; text-align: center; margin-bottom: 10px; }
.english-sentence { margin-bottom: 20px; font-size: 20px; padding: 10px; border: 2px solid #ccc; border-radius: 10px; background-color: #f9f9f9; text-align: center; }
.french-sentence { margin-bottom: 20px; font-size: 20px; }
.missing-word { width: 10px; padding: 0px; font-size: 20px; border: none; border-bottom: 0.5px solid #000; background-color: transparent; outline: none; margin-right: 2px; text-align: center; }
.correct { background-color: #cef4ce; }
.incorrect { background-color: #ffb6c19c; }
#keyboardContainer { text-align: center; margin-top: 20px; }
.keyboard-button { font-size: 18px; padding: 10px 15px; margin: 2px; border: none; border-radius: 10px; background-color: #10148; color: #000; box-shadow: 0 4px 8px rgba(0,0,0,0.3); transition: background-color 0.3s, transform 0.2s; }
.keyboard-button:hover { background-color: #A9A9A9; transform: translateY(-4px); }
select { width: 20%; padding: 5px; border-radius: 10px; margin-bottom: 10px; height: 35px; }
button { padding: 10px 20px; border-radius: 10px; cursor: pointer; margin: 5px; }
</style>
</head>
<body>
<div class="container">
  <div class="title">No vowels</div>
  <div class="subtitle" id="subtitle">Fill in the sentence with the correct vowels.</div>
  <div class="counter" id="sentenceCounter"></div>
  <div id="exerciseOutput"></div>
  <select id="languageSelect" onchange="generateKeyboard(this.value)">
    <option value="french" selected>French</option>
    <option value="german">German</option>
    <option value="spanish">Spanish</option>
  </select>
  <div id="keyboardContainer"></div>
  <button id="nextButton" class="hide" onclick="nextText()">Next</button>
  <button id="resetButton" class="hide" onclick="resetActivity()">Restart</button>
</div>

<script>
let currentTextIndex = 0;
let sentencePairs = [];
let lastFocusedInput = null;
const vowels = ['a','e','i','o','u','à','â','ä','é','è','ê','ë','î','ï','ô','ö','ù','ü','û','á','é','í','ó','ú'];

// Replace this with your CSV link
const sheetUrl = "YOUR_CSV_LINK_HERE";

Papa.parse(sheetUrl, {
  download: true,
  header: true,
  skipEmptyLines: true,
  complete: function(results) {
    const fullList = results.data.filter(row => row.French && row.English).map(row => ({
      french: row.French.trim(),
      english: row.English.trim()
    }));
    if(fullList.length === 0){ alert("No items found in columns French and English!"); return; }

    // Pick 10 random items
    sentencePairs = shuffleArray(fullList).slice(0,10);

    generateKeyboard('french');
    generateChunk(); // Start exercise on page load
  },
  error: function(err){ console.error(err); alert("CSV load error"); }
});

function generateKeyboard(language){
  const keyboardContainer = document.getElementById('keyboardContainer');
  keyboardContainer.innerHTML='';
  let chars=[];
  switch(language){
    case 'german': chars=['ä','ö','ü','ß']; break;
    case 'french': chars=['à','â','ä','é','è','ê','ë','î','ï','ô','ö','ù','ü','û','ç']; break;
    case 'spanish': chars=['á','é','í','ó','ú','ñ']; break;
  }
  chars.forEach(c=>{
    let btn=document.createElement('button');
    btn.textContent=c;
    btn.className='keyboard-button';
    btn.type='button';
    btn.onclick=()=>insertCharacter(c);
    keyboardContainer.appendChild(btn);
  });
}

function insertCharacter(char){
  if(lastFocusedInput){
    const pos=lastFocusedInput.selectionStart;
    const val=lastFocusedInput.value;
    lastFocusedInput.value = val.slice(0,pos)+char+val.slice(pos);
    lastFocusedInput.setSelectionRange(pos+1,pos+1);
    validateCharacter(lastFocusedInput);
  }
}

function generateChunk(){
  const englishSentence = sentencePairs[currentTextIndex].english;
  const frenchSentence = sentencePairs[currentTextIndex].french;

  let sentenceWithInputs='';
  for(let i=0;i<frenchSentence.length;i++){
    const ch=frenchSentence[i];
    if(vowels.includes(ch.toLowerCase())){
      sentenceWithInputs+=`<input type="text" class="missing-word" data-index="${i}" oninput="validateCharacter(this)" onfocus="lastFocusedInput=this">`;
    } else sentenceWithInputs+=ch;
  }

  const exerciseOutput=document.getElementById('exerciseOutput');
  exerciseOutput.innerHTML=`<div class="english-sentence">${englishSentence}</div><div class="french-sentence">${sentenceWithInputs}</div>`;
  document.getElementById('sentenceCounter').textContent=(currentTextIndex+1)+'/'+sentencePairs.length;
  document.getElementById('nextButton').classList.add('hide');
  document.getElementById('resetButton').classList.add('hide');
}

function validateCharacter(input){
  const userInput = input.value.trim().toLowerCase();
  if(userInput==='') input.classList.remove('correct','incorrect');
  else{
    const correctChar = sentencePairs[currentTextIndex].french[input.dataset.index];
    if(userInput===correctChar.toLowerCase()){ input.classList.add('correct'); input.classList.remove('incorrect'); }
    else{ input.classList.add('incorrect'); input.classList.remove('correct'); }
  }
  const nextInput=input.nextElementSibling;
  if(nextInput && nextInput.classList.contains('missing-word')) nextInput.focus();
  checkAnswers();
}

function checkAnswers(){
  const inputs = document.querySelectorAll('.missing-word');
  let allCorrect = true;
  inputs.forEach(input=>{ if(!input.classList.contains('correct')) allCorrect=false; });
  if(allCorrect){
    if(currentTextIndex===sentencePairs.length-1) document.getElementById('resetButton').classList.remove('hide');
    else document.getElementById('nextButton').classList.remove('hide');
  }
}

function nextText(){
  currentTextIndex=(currentTextIndex+1)%sentencePairs.length;
  generateChunk();
}

function resetActivity(){
  currentTextIndex=0;
  sentencePairs=shuffleArray(sentencePairs);
  generateChunk();
}

function shuffleArray(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
  return array;
}
</script>
</body>
</html>
