<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>No vowels - Vocab Game</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
body { font-family: Arial, sans-serif; }
.container { width: 100%; padding: 20px; box-sizing: border-box; font-size: 16px; }
.title { font-size: 40px; font-weight: bold; text-align: center; margin-bottom: 20px; }
.subtitle { font-size: 20px; margin-bottom: 10px; text-align: center; }
.french-word { font-size: 30px; text-align: center; margin-bottom: 20px; }
.english-word { font-size: 24px; text-align: center; margin-bottom: 20px; background:#eee; border-radius:10px; padding:5px 10px; display:inline-block; }
.missing-word { width: 15px; font-size: 20px; border: none; border-bottom: 1px solid #000; background: transparent; text-align: center; margin-right: 2px; }
.correct { background-color: #cef4ce; }
.incorrect { background-color: #ffb6c19c; }
.keyboard-container { text-align: center; margin-top: 20px; }
.keyboard-button { font-size: 18px; padding: 10px 15px; margin: 2px; border: none; border-radius: 10px; background-color: #10148; color: #000; cursor: pointer; }
.keyboard-button:hover { background-color: #A9A9A9; transform: translateY(-4px); }
select { width: 20%; padding: 5px; border-radius: 10px; margin-bottom: 10px; height: 35px; display: block; margin: 10px auto; }
.feedback { font-weight: bold; font-size: 18px; text-align: center; margin-top: 10px; }
#nextButton { display:none; margin-top:10px; }
</style>
</head>
<body>
<div class="container">
  <div class="title">No vowels - Vocab game</div>
  <div class="subtitle">Fill in the missing vowels</div>
  <div class="english-word" id="englishWord"></div>
  <div class="french-word" id="frenchWord"></div>
  <div id="keyboardContainer" class="keyboard-container"></div>
  <select id="languageSelect">
    <option value="french" selected>French</option>
    <option value="german">German</option>
    <option value="spanish">Spanish</option>
  </select>
  <div class="feedback" id="feedback"></div>
  <button id="nextButton">Next</button>
</div>

<script>
let vocabList = [];
let exerciseWords = [];
let currentIndex = 0;
let lastFocusedInput = null;
const vowels = ['a','e','i','o','u','Ã ','Ã¢','Ã¤','Ã©','Ã¨','Ãª','Ã«','Ã®','Ã¯','Ã´','Ã¶','Ã¹','Ã¼','Ã»','Ã¡','Ã©','Ã­','Ã³','Ãº'];

const params = new URLSearchParams(window.location.search);
const sheetUrl = params.get('sheet'); // CSV URL like ?sheet=https://...

if(!sheetUrl){ alert("No sheet URL provided!"); }

Papa.parse(sheetUrl, {
  download: true,
  header: true,
  skipEmptyLines: true,
  complete: function(results){
    results.data.forEach(row => {
      if(row.French && row.English){
        vocabList.push({ french: row.French.trim(), english: row.English.trim() });
      }
    });
    if(vocabList.length === 0){ alert("No items found in columns A/B!"); return; }

    // Pick 10 random words
    exerciseWords = vocabList.sort(() => 0.5 - Math.random()).slice(0,10);
    currentIndex = 0;
    generateExercise();
    generateKeyboard('french');
  },
  error: function(err){ console.error(err); alert("CSV load error: " + err); }
});

function generateExercise(){
  if(currentIndex >= exerciseWords.length){
    document.getElementById('frenchWord').textContent = "ðŸŽ‰ Completed all words!";
    document.getElementById('englishWord').textContent = "";
    document.getElementById('feedback').textContent = "";
    document.getElementById('nextButton').style.display="none";
    return;
  }

  const word = exerciseWords[currentIndex].french;
  document.getElementById('englishWord').textContent = exerciseWords[currentIndex].english;
  const wordDiv = document.getElementById('frenchWord');
  wordDiv.innerHTML = "";

  for(let i=0; i<word.length; i++){
    const char = word[i];
    if(vowels.includes(char.toLowerCase())){
      const input = document.createElement('input');
      input.type = 'text';
      input.maxLength = 1;
      input.className = 'missing-word';
      input.dataset.index = i;
      input.addEventListener('input', validateInput);
      input.addEventListener('focus', () => { lastFocusedInput = input; });
      wordDiv.appendChild(input);
    } else {
      const span = document.createElement('span');
      span.textContent = char;
      wordDiv.appendChild(span);
    }
  }

  document.getElementById('feedback').textContent = "";
  document.getElementById('nextButton').style.display="none";
}

function validateInput(e){
  const input = e.target;
  const word = exerciseWords[currentIndex].french;
  const correctChar = word[input.dataset.index].toLowerCase();

  if(input.value.toLowerCase() === correctChar){
    input.classList.add('correct');
    input.classList.remove('incorrect');
  } else {
    input.classList.add('incorrect');
    input.classList.remove('correct');
  }

  // Automatically move cursor to next input
  let nextInput = input.nextElementSibling;
  while(nextInput && !nextInput.classList.contains('missing-word')){
    nextInput = nextInput.nextElementSibling;
  }
  if(nextInput){ nextInput.focus(); }

  // Check if all inputs correct
  const allInputs = document.querySelectorAll('.missing-word');
  let allCorrect = true;
  allInputs.forEach(inp => { if(!inp.classList.contains('correct')) allCorrect = false; });

  if(allCorrect){
    document.getElementById('feedback').textContent = "Correct âœ…";
    document.getElementById('nextButton').style.display="inline-block";
  }
}

document.getElementById('nextButton').addEventListener('click', () => {
  currentIndex++;
  generateExercise();
});

function generateKeyboard(language){
  const container = document.getElementById('keyboardContainer');
  container.innerHTML = '';
  let chars = [];
  switch(language){
    case 'french': chars=['Ã ','Ã¢','Ã¤','Ã©','Ã¨','Ãª','Ã«','Ã®','Ã¯','Ã´','Ã¶','Ã¹','Ã¼','Ã»','Ã§']; break;
    case 'german': chars=['Ã¤','Ã¶','Ã¼','ÃŸ']; break;
    case 'spanish': chars=['Ã¡','Ã©','Ã­','Ã³','Ãº','Ã±']; break;
  }
  chars.forEach(c => {
    const btn = document.createElement('button');
    btn.textContent = c;
    btn.className = 'keyboard-button';
    btn.type = 'button';
    btn.onclick = () => {
      if(lastFocusedInput){
        const pos = lastFocusedInput.selectionStart;
        const val = lastFocusedInput.value;
        lastFocusedInput.value = val.slice(0,pos) + c + val.slice(pos);
        lastFocusedInput.setSelectionRange(pos+1,pos+1);
        lastFocusedInput.focus();
        lastFocusedInput.dispatchEvent(new Event('input'));
      }
    };
    container.appendChild(btn);
  });
}

document.getElementById('languageSelect').addEventListener('change', (e) => {
  generateKeyboard(e.target.value);
});
</script>
</body>
</html>
